<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ¦„ Unicorn Spelling Journey</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

    /* â”€â”€ Base â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Nunito', 'Comic Sans MS', cursive;
      background: linear-gradient(160deg, #ffe4f0 0%, #ffd6f0 40%, #f9c6ff 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px 12px 48px;
    }

    /* â”€â”€ Header â”€â”€ */
    h1 {
      font-size: 2rem;
      font-weight: 900;
      color: #c0006a;
      text-shadow: 2px 2px 0 #fff, 4px 4px 0 #f9a8d4;
      margin-bottom: 4px;
      text-align: center;
    }

    #stars-bar {
      font-size: 1.1rem;
      color: #e05ca0;
      margin-bottom: 10px;
    }

    /* â”€â”€ Map â”€â”€ */
    #map-wrap {
      width: 100%;
      max-width: 560px;
      margin-bottom: 10px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 18px #f472b630;
      border: 3px solid #f9a8d4;
      background: #fff8fd;
      position: relative;
    }

    #map-svg { display: block; width: 100%; height: auto; }

    /* unicorn marker on the map */
    .map-unicorn {
      font-size: 1.5rem;
      position: absolute;
      transform: translate(-50%, -100%);
      transition: left 0.8s cubic-bezier(0.4,0,0.2,1), top 0.8s cubic-bezier(0.4,0,0.2,1);
      pointer-events: none;
      filter: drop-shadow(0 2px 4px #f472b690);
      z-index: 10;
    }

    @keyframes unicornBounce {
      from { transform: translate(-50%, -100%) rotate(-6deg); }
      to   { transform: translate(-50%, -115%) rotate(6deg); }
    }

    .map-unicorn.bouncing { animation: unicornBounce 0.55s ease infinite alternate; }

    /* â”€â”€ Level label â”€â”€ */
    #level-label {
      font-size: 0.9rem;
      color: #be185d;
      margin-bottom: 12px;
      font-weight: 700;
    }

    /* â”€â”€ Game card â”€â”€ */
    #game-card {
      background: #fff;
      border-radius: 28px;
      padding: 26px 28px 22px;
      box-shadow: 0 8px 32px #f472b640;
      max-width: 520px;
      width: 100%;
      text-align: center;
      border: 3px solid #f9a8d4;
      position: relative;
    }

    /* â”€â”€ Hint image / emoji â”€â”€ */
    #word-hint {
      font-size: 4rem;
      margin-bottom: 6px;
      animation: popIn 0.4s ease;
    }

    #word-clue {
      font-size: 0.95rem;
      color: #be185d;
      margin-bottom: 14px;
      font-style: italic;
    }

    /* â”€â”€ Word display â”€â”€ */
    #word-display {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .letter-box {
      width: 46px;
      height: 52px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      font-weight: 900;
      border: 3px solid #f9a8d4;
      background: #fff0f8;
      color: #c0006a;
      transition: transform 0.2s;
    }

    .letter-box.blank {
      border: 3px dashed #f472b6;
      background: #fff;
      color: transparent;
      font-size: 1rem;
      position: relative;
    }

    .letter-box.blank::after {
      content: '?';
      position: absolute;
      color: #f9a8d4;
      font-size: 1.6rem;
      font-weight: 900;
    }

    .letter-box.correct-reveal {
      background: #fce7f3;
      border-color: #ec4899;
      animation: popIn 0.35s ease;
    }

    .letter-box.wrong-shake { animation: shake 0.4s ease; }

    @keyframes popIn {
      from { transform: scale(0.6); opacity: 0; }
      to   { transform: scale(1);   opacity: 1; }
    }

    @keyframes shake {
      0%,100% { transform: translateX(0); }
      25%     { transform: translateX(-8px) rotate(-3deg); }
      75%     { transform: translateX(8px)  rotate(3deg); }
    }

    /* â”€â”€ Letter choices â”€â”€ */
    #choices {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    .choice-btn {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      font-size: 1.7rem;
      font-weight: 900;
      font-family: inherit;
      border: 3px solid #f9a8d4;
      background: #fff0f8;
      color: #c0006a;
      cursor: pointer;
      transition: transform 0.15s, background 0.15s, border-color 0.15s;
    }

    .choice-btn:hover   { transform: scale(1.18); background: #fce7f3; }
    .choice-btn.correct { background: #fbcfe8; border-color: #db2777; animation: bounce 0.4s ease; }
    .choice-btn.wrong   { background: #ffe4e6; border-color: #f43f5e; animation: shake 0.4s ease; }
    .choice-btn:disabled { opacity: 0.5; cursor: default; transform: none; }

    @keyframes bounce {
      0%,100% { transform: scale(1); }
      50%     { transform: scale(1.3); }
    }

    /* â”€â”€ Door / gate â”€â”€ */
    #door-wrap {
      margin: 0 auto 16px;
      position: relative;
      width: 110px;
      height: 130px;
    }

    .door-frame {
      position: absolute;
      inset: 0;
      border: 5px solid #f472b6;
      border-radius: 55px 55px 6px 6px;
      background: #fff0f8;
      overflow: hidden;
    }

    .door-panel {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, #fce7f3, #fbcfe8);
      border-radius: 52px 52px 4px 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.6rem;
      transform-origin: left center;
      transition: transform 0.7s cubic-bezier(0.4,0,0.2,1);
    }

    .door-panel.open { transform: perspective(400px) rotateY(-110deg); }

    .door-knob {
      position: absolute;
      right: 14px;
      top: 50%;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #f472b6;
      border: 2px solid #be185d;
    }

    /* â”€â”€ Feedback â”€â”€ */
    #feedback {
      font-size: 1.2rem;
      font-weight: 700;
      min-height: 32px;
      margin-bottom: 8px;
    }

    #feedback.good { color: #be185d; }
    #feedback.bad  { color: #f43f5e; }

    /* â”€â”€ Next btn â”€â”€ */
    #next-btn {
      display: none;
      padding: 11px 30px;
      font-size: 1.1rem;
      font-family: inherit;
      font-weight: 900;
      background: linear-gradient(135deg, #f472b6, #ec4899);
      border: none;
      border-radius: 40px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 14px #f472b660;
      transition: transform 0.15s;
    }

    #next-btn:hover { transform: scale(1.08); }

    /* â”€â”€ Level complete screen â”€â”€ */
    #level-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      text-align: center;
    }

    #level-screen .big-emoji { font-size: 3.8rem; animation: unicornBounce 0.7s ease infinite alternate; }
    #level-screen h2 { font-size: 1.7rem; color: #be185d; text-shadow: 1px 1px 0 #fce7f3; }
    #level-screen p  { font-size: 1rem; color: #9d174d; }

    #next-level-btn {
      padding: 12px 30px;
      font-size: 1.1rem;
      font-family: inherit;
      font-weight: 900;
      background: linear-gradient(135deg, #a855f7, #ec4899);
      border: none;
      border-radius: 40px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 14px #a855f740;
      transition: transform 0.15s;
    }

    #next-level-btn:hover { transform: scale(1.08); }

    /* â”€â”€ Win screen â”€â”€ */
    #win-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      text-align: center;
    }

    #win-screen .unicorn-big {
      font-size: 6rem;
      animation: unicornBounce 0.6s ease infinite alternate;
    }

    #win-screen h2 { font-size: 2rem; color: #be185d; text-shadow: 2px 2px 0 #fce7f3; }
    #win-screen p  { font-size: 1.05rem; color: #9d174d; }

    .confetti-row { font-size: 1.6rem; letter-spacing: 6px; animation: fadeSlide 0.5s ease; }

    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(-10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    #play-again-btn {
      padding: 13px 32px;
      font-size: 1.1rem;
      font-family: inherit;
      font-weight: 900;
      background: linear-gradient(135deg, #ec4899, #f472b6);
      border: none;
      border-radius: 40px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 14px #ec489960;
      transition: transform 0.15s;
    }

    #play-again-btn:hover { transform: scale(1.08); }

    /* â”€â”€ Mobile â”€â”€ */
    @media (max-width: 480px) {
      body { padding: 10px 8px 36px; }
      h1 { font-size: 1.5rem; }
      #game-card { padding: 18px 14px 16px; border-radius: 20px; }
      #word-hint { font-size: 3rem; }
      .letter-box { width: 38px; height: 44px; font-size: 1.4rem; border-radius: 10px; }
      .choice-btn { width: 50px; height: 50px; font-size: 1.4rem; }
      #door-wrap { width: 90px; height: 108px; }
      #win-screen .unicorn-big { font-size: 4.5rem; }
    }
  </style>
</head>
<body>

  <h1>ğŸ¦„ Unicorn Spelling Journey</h1>
  <div id="stars-bar">â­ <span id="star-count">0</span> stars</div>

  <!-- Illustrated map -->
  <div id="map-wrap">
    <svg id="map-svg" viewBox="0 0 560 210" xmlns="http://www.w3.org/2000/svg">

      <!-- Sky gradient -->
      <defs>
        <linearGradient id="skyGrad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#ffe4f8"/>
          <stop offset="100%" stop-color="#fff0fb"/>
        </linearGradient>
        <linearGradient id="pathGrad" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stop-color="#f9a8d4"/>
          <stop offset="100%" stop-color="#c084fc"/>
        </linearGradient>
      </defs>
      <rect width="560" height="210" fill="url(#skyGrad)"/>

      <!-- Rolling hills -->
      <ellipse cx="100" cy="210" rx="140" ry="55" fill="#fce7f3"/>
      <ellipse cx="320" cy="210" rx="160" ry="50" fill="#f5d0fe"/>
      <ellipse cx="500" cy="210" rx="120" ry="45" fill="#fce7f3"/>

      <!-- Winding path (stroke only â€” thick pink dashed road) -->
      <!-- Path visits all 11 stops: start â†’ 10 landmarks â†’ unicorn -->
      <path id="road-path"
        d="M 30,180 C 60,170 80,155 110,148
           C 140,141 155,130 180,125
           C 210,118 225,108 255,105
           C 285,102 300,112 328,108
           C 356,104 368,90 395,88
           C 422,86 435,98 462,95
           C 489,92 505,80 530,78"
        fill="none" stroke="#f9a8d4" stroke-width="10" stroke-linecap="round" opacity="0.5"/>
      <!-- Bright overlay dashes -->
      <path
        d="M 30,180 C 60,170 80,155 110,148
           C 140,141 155,130 180,125
           C 210,118 225,108 255,105
           C 285,102 300,112 328,108
           C 356,104 368,90 395,88
           C 422,86 435,98 462,95
           C 489,92 505,80 530,78"
        fill="none" stroke="white" stroke-width="3" stroke-dasharray="10 12"
        stroke-linecap="round" opacity="0.7"/>

      <!-- STOP CIRCLES (11 stops: indices 0-10, last = unicorn goal) -->
      <!-- Stop coords match the path â€” pre-sampled points -->
      <!-- 0 start -->
      <circle cx="30"  cy="180" r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 1 -->
      <circle cx="110" cy="148" r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 2 -->
      <circle cx="180" cy="125" r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 3 -->
      <circle cx="255" cy="105" r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 4 -->
      <circle cx="328" cy="108" r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 5 -->
      <circle cx="395" cy="88"  r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 6 -->
      <circle cx="462" cy="95"  r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>
      <!-- 7 -->
      <circle cx="530" cy="78"  r="11" fill="#fce7f3" stroke="#f472b6" stroke-width="2.5"/>

      <!-- Decorative landmarks (emoji-style text) -->
      <!-- Flowers near start -->
      <text x="20"  y="200" font-size="16">ğŸŒ¸</text>
      <text x="55"  y="195" font-size="13">ğŸŒ·</text>
      <!-- Candy house -->
      <text x="92"  y="170" font-size="18">ğŸ </text>
      <!-- Rainbow -->
      <text x="163" y="148" font-size="18">ğŸŒˆ</text>
      <!-- Teddy bear forest -->
      <text x="237" y="128" font-size="16">ğŸ»</text>
      <text x="225" y="145" font-size="12">ğŸŒ²</text>
      <!-- Stars field -->
      <text x="310" y="130" font-size="14">â­</text>
      <text x="330" y="122" font-size="11">âœ¨</text>
      <!-- Magic mushroom -->
      <text x="376" y="112" font-size="17">ğŸ„</text>
      <!-- Butterfly -->
      <text x="444" y="117" font-size="16">ğŸ¦‹</text>
      <!-- Castle -->
      <text x="510" y="100" font-size="20">ğŸ°</text>
      <!-- Unicorn goal (greyed until win) -->
      <text id="map-goal-uni" x="530" y="60" font-size="22" opacity="0.3">ğŸ¦„</text>

      <!-- Level number labels on stops -->
      <text x="30"  y="184" font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">S</text>
      <text x="110" y="152" font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">1</text>
      <text x="180" y="129" font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">2</text>
      <text x="255" y="109" font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">3</text>
      <text x="328" y="112" font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">4</text>
      <text x="395" y="92"  font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">5</text>
      <text x="462" y="99"  font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">6</text>
      <text x="530" y="82"  font-size="8" text-anchor="middle" fill="#be185d" font-weight="bold">7</text>

      <!-- Done path overlay (coloured fill) â€” drawn by JS -->
      <path id="done-path" fill="none" stroke="#ec4899" stroke-width="10"
            stroke-linecap="round" opacity="0.55" stroke-dasharray="0 9999"/>

    </svg>
    <!-- Unicorn marker moved by JS -->
    <div class="map-unicorn bouncing" id="map-uni">ğŸ¦„</div>
  </div>
  <div id="level-label"></div>

  <div id="game-card">

    <!-- Game view -->
    <div id="game-view">
      <div id="word-hint"></div>
      <div id="word-clue"></div>
      <div id="word-display"></div>

      <!-- Door -->
      <div id="door-wrap">
        <div class="door-frame">
          <div class="door-panel" id="door-panel">ğŸŒ¸</div>
          <div class="door-knob"></div>
        </div>
      </div>

      <!-- Letter choices -->
      <div id="choices"></div>

      <div id="feedback"></div>
      <button id="next-btn">Next â¡ï¸</button>
    </div>

    <!-- Level complete -->
    <div id="level-screen">
      <div class="big-emoji" id="lc-emoji"></div>
      <h2 id="lc-title"></h2>
      <p  id="lc-msg"></p>
      <button id="next-level-btn">Next Level â¡ï¸</button>
    </div>

    <!-- Win! -->
    <div id="win-screen">
      <div class="unicorn-big">ğŸ¦„</div>
      <div class="confetti-row">ğŸ€ğŸŒ¸ğŸ’–ğŸŒˆâœ¨ğŸ€</div>
      <h2>You found the Unicorn!</h2>
      <p id="win-msg"></p>
      <button id="play-again-btn">Play Again ğŸ€</button>
    </div>

  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SOUND
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let _ctx = null;
    const ctx = () => { if (!_ctx) _ctx = new AudioCtx(); return _ctx; };

    function tone(freq, type, dur, vol = 0.25, delay = 0) {
      const c = ctx(), o = c.createOscillator(), g = c.createGain();
      o.connect(g); g.connect(c.destination);
      o.type = type;
      o.frequency.setValueAtTime(freq, c.currentTime + delay);
      g.gain.setValueAtTime(vol, c.currentTime + delay);
      g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + delay + dur);
      o.start(c.currentTime + delay);
      o.stop(c.currentTime + delay + dur);
    }

    const sndCorrect  = () => { tone(600,'sine',0.1,0.22,0); tone(750,'sine',0.1,0.22,0.1); tone(900,'sine',0.15,0.22,0.2); };
    const sndWrong    = () => { tone(250,'sawtooth',0.15,0.2,0); tone(200,'sawtooth',0.15,0.18,0.14); };
    const sndDoor     = () => [440,554,659,880].forEach((f,i) => tone(f,'sine',0.18,0.22,i*0.08));
    const sndLevelUp  = () => [330,415,523,659,784,1047].forEach((f,i) => tone(f,'triangle',0.16,0.24,i*0.09));
    const sndWin      = () => [523,659,784,1047,784,880,1047,1319].forEach((f,i) => tone(f,'sine',0.2,0.26,i*0.11));

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEVELS  â€” 10 levels Ã— 3 words each, ascending difficulty
    // Each word: { word, missing (0-based index), emoji, clue }
    // Level 1â€“2:  CVC words (3-letter), 1 missing vowel
    // Level 3â€“4:  4-letter words, 1 missing
    // Level 5â€“6:  4â€“5 letter words, trickier positions
    // Level 7â€“8:  5-letter words
    // Level 9â€“10: 5â€“6 letter words, consonant clusters
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const LEVELS = [
      { name: 'Level 1 â€“ Tiny Words ğŸŒ¸', emoji: 'ğŸŒ¸', words: [
        { word:'CAT', missing:1, emoji:'ğŸ±', clue:'A fluffy pet that says meow!' },
        { word:'DOG', missing:1, emoji:'ğŸ¶', clue:'A pet that loves to fetch!' },
        { word:'SUN', missing:1, emoji:'â˜€ï¸', clue:'It shines bright in the sky!' },
      ]},
      { name: 'Level 2 â€“ Animal Friends ğŸ¾', emoji: 'ğŸ¾', words: [
        { word:'HEN', missing:1, emoji:'ğŸ”', clue:'A farm bird that lays eggs!' },
        { word:'PIG', missing:1, emoji:'ğŸ·', clue:'Oink oink! Pink and round!' },
        { word:'BEE', missing:2, emoji:'ğŸ', clue:'It makes honey and goes buzz!' },
      ]},
      { name: 'Level 3 â€“ Sweet Things ğŸ­', emoji: 'ğŸ­', words: [
        { word:'CAKE', missing:1, emoji:'ğŸ‚', clue:'Yummy on your birthday!' },
        { word:'MILK', missing:2, emoji:'ğŸ¥›', clue:'White drink from a cow!' },
        { word:'FISH', missing:2, emoji:'ğŸ ', clue:'It swims in the sea!' },
      ]},
      { name: 'Level 4 â€“ Around You ğŸ¡', emoji: 'ğŸ¡', words: [
        { word:'BOOK', missing:2, emoji:'ğŸ“š', clue:'You read stories in this!' },
        { word:'DOOR', missing:2, emoji:'ğŸšª', clue:'You open it to go inside!' },
        { word:'FROG', missing:2, emoji:'ğŸ¸', clue:'Green and loves to jump!' },
      ]},
      { name: 'Level 5 â€“ Colours & Fun ğŸ¨', emoji: 'ğŸ¨', words: [
        { word:'PINK',  missing:1, emoji:'ğŸŒ¸', clue:'The prettiest colour!' },
        { word:'BEAR',  missing:1, emoji:'ğŸ§¸', clue:'A fluffy cuddly toy!' },
        { word:'STAR',  missing:2, emoji:'â­', clue:'It twinkles at night!' },
      ]},
      { name: 'Level 6 â€“ Nature Walk ğŸŒ¿', emoji: 'ğŸŒ¿', words: [
        { word:'CLOUD', missing:2, emoji:'â˜ï¸', clue:'Fluffy white things in the sky!' },
        { word:'GRASS', missing:3, emoji:'ğŸŒ±', clue:'Green stuff on the ground!' },
        { word:'LEAF',  missing:2, emoji:'ğŸƒ', clue:'It grows on trees!' },
      ]},
      { name: 'Level 7 â€“ Big World ğŸŒ', emoji: 'ğŸŒ', words: [
        { word:'SMILE',  missing:2, emoji:'ğŸ˜Š', clue:'What your face does when happy!' },
        { word:'HEART',  missing:2, emoji:'ğŸ’–', clue:'It means love!' },
        { word:'TIGER',  missing:2, emoji:'ğŸ¯', clue:'A stripy wild cat!' },
      ]},
      { name: 'Level 8 â€“ Magic Things âœ¨', emoji: 'âœ¨', words: [
        { word:'CROWN',  missing:3, emoji:'ğŸ‘‘', clue:'A princess wears this!' },
        { word:'FAIRY',  missing:2, emoji:'ğŸ§š', clue:'She has tiny wings and magic dust!' },
        { word:'MAGIC',  missing:1, emoji:'ğŸª„', clue:'A wizard\'s special power!' },
      ]},
      { name: 'Level 9 â€“ Bigger Words ğŸ¦‹', emoji: 'ğŸ¦‹', words: [
        { word:'TEDDY',  missing:3, emoji:'ğŸ§¸', clue:'A soft cuddly bear!' },
        { word:'BUNNY',  missing:3, emoji:'ğŸ°', clue:'Has long ears and hops!' },
        { word:'SUNNY',  missing:2, emoji:'â˜€ï¸', clue:'A bright and warm day!' },
      ]},
      { name: 'Level 10 â€“ Champion! ğŸ†', emoji: 'ğŸ†', words: [
        { word:'CASTLE',  missing:2, emoji:'ğŸ°', clue:'Where a princess lives!' },
        { word:'PRINCE',  missing:3, emoji:'ğŸ¤´', clue:'He wears a crown and cape!' },
        { word:'FLOWER',  missing:3, emoji:'ğŸŒ¸', clue:'Pretty and smells nice!' },
      ]},
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

    function shuffle(arr){
      const a=[...arr];
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    // Generate 3 wrong letter choices (uppercase, no duplicates, not the answer)
    function buildLetterChoices(correct) {
      const alpha = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const set = new Set([correct]);
      let tries = 0;
      while (set.size < 4 && tries < 200) {
        set.add(alpha[randInt(0, 25)]);
        tries++;
      }
      return shuffle([...set]);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let levelIdx   = 0;
    let wordIdx    = 0;
    let totalStars = 0;
    let levelStars = 0;
    let answered   = false;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DOM
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const $ = id => document.getElementById(id);
    const wordHint    = $('word-hint');
    const wordClue    = $('word-clue');
    const wordDisplay = $('word-display');
    const choicesEl   = $('choices');
    const feedbackEl  = $('feedback');
    const nextBtn     = $('next-btn');
    const doorPanel   = $('door-panel');
    const starCount   = $('star-count');
    const levelLabel  = $('level-label');
    const gameView    = $('game-view');
    const levelScreen = $('level-screen');
    const winScreen   = $('win-screen');

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MAP  â€” stop coordinates in SVG space (viewBox 560Ã—210)
    // Index 0 = start, 1-10 = after each level, 11 = unicorn goal
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const STOP_COORDS = [
      { x: 30,  y: 180 }, // start
      { x: 110, y: 148 }, // after level 1
      { x: 180, y: 125 }, // after level 2
      { x: 255, y: 105 }, // after level 3
      { x: 328, y: 108 }, // after level 4
      { x: 395, y: 88  }, // after level 5
      { x: 462, y: 95  }, // after level 6
      { x: 530, y: 78  }, // after level 7
      // levels 8-10 converge to unicorn
      { x: 530, y: 60  }, // after level 8
      { x: 530, y: 60  }, // after level 9
      { x: 530, y: 60  }, // after level 10 â€” unicorn!
    ];

    // Convert SVG coords â†’ CSS % on the map-wrap div
    function svgToPercent(sx, sy) {
      return { left: (sx / 560 * 100) + '%', top: (sy / 210 * 100) + '%' };
    }

    // Colour the done circles and move the unicorn marker
    function updateMap() {
      const svgEl   = document.getElementById('map-svg');
      const uniEl   = document.getElementById('map-uni');
      const goalEl  = document.getElementById('map-goal-uni');
      const circles = svgEl.querySelectorAll('circle');

      // Colour past stops pink
      circles.forEach((c, i) => {
        // circle index 0 = start, 1..7 = levels 1-7
        if (i < levelIdx) {
          c.setAttribute('fill', '#f472b6');
          c.setAttribute('stroke', '#be185d');
        } else if (i === levelIdx) {
          c.setAttribute('fill', '#fff');
          c.setAttribute('stroke', '#c0006a');
        } else {
          c.setAttribute('fill', '#fce7f3');
          c.setAttribute('stroke', '#f472b6');
        }
      });

      // Move unicorn to current stop
      const stopIdx = Math.min(levelIdx, STOP_COORDS.length - 1);
      const coord   = STOP_COORDS[stopIdx];
      const pos     = svgToPercent(coord.x, coord.y);
      uniEl.style.left = pos.left;
      uniEl.style.top  = pos.top;

      // Light up goal unicorn when done
      if (levelIdx >= LEVELS.length) {
        goalEl.setAttribute('opacity', '1');
        uniEl.style.display = 'none'; // unicorn arrived â€” show the goal one
      } else {
        goalEl.setAttribute('opacity', '0.25');
        uniEl.style.display = 'block';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER WORD
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function renderWord() {
      const level = LEVELS[levelIdx];
      const { word, missing, emoji, clue } = level.words[wordIdx];
      const correctLetter = word[missing];
      answered = false;

      wordHint.textContent = emoji;
      wordClue.textContent = clue;

      // Word boxes
      wordDisplay.innerHTML = '';
      [...word].forEach((ch, i) => {
        const box = document.createElement('div');
        box.className = 'letter-box' + (i === missing ? ' blank' : '');
        box.textContent = i === missing ? '' : ch;
        if (i === missing) box.id = 'blank-box';
        wordDisplay.appendChild(box);
      });

      // Door â€” closed
      doorPanel.classList.remove('open');
      doorPanel.textContent = 'ğŸ”’';

      // Letter choices
      choicesEl.innerHTML = '';
      buildLetterChoices(correctLetter).forEach(letter => {
        const btn = document.createElement('button');
        btn.className   = 'choice-btn';
        btn.textContent = letter;
        btn.addEventListener('click', () => handleChoice(btn, letter, correctLetter));
        choicesEl.appendChild(btn);
      });

      feedbackEl.textContent = '';
      feedbackEl.className   = '';
      nextBtn.style.display  = 'none';

      levelLabel.textContent =
        `${level.name}  Â·  Word ${wordIdx + 1} of ${level.words.length}`;

      updateMap();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HANDLE CHOICE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function handleChoice(btn, chosen, correct) {
      if (answered) return;
      answered = true;

      document.querySelectorAll('.choice-btn').forEach(b => b.disabled = true);
      const blankBox = $('blank-box');

      if (chosen === correct) {
        btn.classList.add('correct');
        blankBox.textContent  = correct;
        blankBox.className    = 'letter-box correct-reveal';
        feedbackEl.textContent = ['Amazing! ğŸŒ¸', 'You got it! ğŸ’–', 'Brilliant! âœ¨', 'So smart! ğŸ¦„', 'Yay! ğŸ€'][randInt(0,4)];
        feedbackEl.className   = 'good';
        totalStars++; levelStars++;
        starCount.textContent  = totalStars;
        sndCorrect();
        // Open the door after short delay
        setTimeout(() => {
          doorPanel.classList.add('open');
          doorPanel.textContent = 'ğŸŒˆ';
          sndDoor();
        }, 400);
        nextBtn.style.display = 'inline-block';
        nextBtn.textContent   = wordIdx + 1 < LEVELS[levelIdx].words.length ? 'Next Word â¡ï¸' : 'Finish Level ğŸ€';
      } else {
        btn.classList.add('wrong');
        blankBox.classList.add('wrong-shake');
        setTimeout(() => blankBox.classList.remove('wrong-shake'), 450);
        feedbackEl.textContent = `Hmm, not quite! Try again ğŸ˜Š`;
        feedbackEl.className   = 'bad';
        sndWrong();
        // Re-enable after shake
        setTimeout(() => {
          document.querySelectorAll('.choice-btn').forEach(b => {
            b.disabled = false;
            b.classList.remove('wrong', 'correct');
          });
          btn.disabled = true; // disable the wrong one only
          answered = false;
          feedbackEl.textContent = '';
        }, 800);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NEXT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    nextBtn.addEventListener('click', () => {
      wordIdx++;
      if (wordIdx >= LEVELS[levelIdx].words.length) {
        showLevelComplete();
      } else {
        renderWord();
      }
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LEVEL COMPLETE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showLevelComplete() {
      sndLevelUp();
      gameView.style.display   = 'none';
      levelScreen.style.display = 'flex';

      const lv = LEVELS[levelIdx];
      $('lc-emoji').textContent = lv.emoji;
      $('lc-title').textContent = `${lv.name.split('â€“')[0].trim()} complete!`;
      const pct = Math.round((levelStars / lv.words.length) * 100);
      let msg = `You got ${levelStars} / ${lv.words.length} stars! `;
      if (levelStars === lv.words.length) msg += 'Perfect! ğŸŒˆğŸ€';
      else if (pct >= 66)                 msg += 'Really well done! ğŸŒ¸';
      else                                msg += 'Keep going â€” you\'re doing great! ğŸ’ª';
      $('lc-msg').textContent = msg;

      const isLast = levelIdx >= LEVELS.length - 1;
      $('next-level-btn').textContent = isLast ? 'ğŸ¦„ Find the Unicorn!' : 'Next Level â¡ï¸';
    }

    $('next-level-btn').addEventListener('click', () => {
      levelIdx++;
      levelStars = 0;
      wordIdx    = 0;
      levelScreen.style.display = 'none';

      if (levelIdx >= LEVELS.length) {
        showWin();
      } else {
        gameView.style.display = 'block';
        renderWord();
      }
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WIN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showWin() {
      sndWin();
      levelScreen.style.display = 'none';
      winScreen.style.display   = 'flex';
      const total = LEVELS.reduce((s,l) => s + l.words.length, 0);
      const pct   = Math.round((totalStars / total) * 100);
      let msg = `You got ${totalStars} out of ${total} stars! `;
      if (pct === 100)    msg += 'ğŸŒˆ Perfect score â€” you\'re a spelling superstar!';
      else if (pct >= 80) msg += 'ğŸ¦„ Amazing spelling skills!';
      else if (pct >= 60) msg += 'ğŸŒ¸ Great job â€” keep practising!';
      else                msg += 'ğŸ’– Well done for finishing â€” play again to get more stars!';
      $('win-msg').textContent = msg;

      // Animate unicorn on journey
      updateMap();
    }

    $('play-again-btn').addEventListener('click', () => {
      levelIdx   = 0; wordIdx = 0;
      totalStars = 0; levelStars = 0;
      starCount.textContent = 0;
      winScreen.style.display  = 'none';
      gameView.style.display   = 'block';
      updateMap();
      renderWord();
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    updateMap();
    renderWord();
  </script>
</body>
</html>
